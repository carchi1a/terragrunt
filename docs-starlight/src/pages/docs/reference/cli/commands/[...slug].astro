---
import Command from '@components/Command.astro';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';
import { getHeadings } from '../../../../../lib/headings';
import type { SidebarItem } from 'node_modules/@astrojs/starlight/schemas/sidebar';

export async function getStaticPaths() {
	const commands = await getCollection('commands');

	const sidebar: SidebarItem[] = commands.map((command) => {
		const data = command.data;

		if (data.experiment) {
			return {
				label: data.name,
				link: `/docs/reference/cli/commands/${data.path}`,
				badge: {
					variant: 'tip',
					text: 'exp',
				},
			} as SidebarItem;
		}

		return {
			label: data.name,
			link: `/docs/reference/cli/commands/${data.path}`,
		} as SidebarItem;
	});

	return commands.map((command) => {
		const headings = getHeadings(command);

		const data = command.data;

		return {
			params: { 
				slug: data.path,
			},
			props: {
				name: data.name,
				description: data.description,
				experiment: data.experiment,
				examples: data.examples,
				headings: headings,
				sidebar: sidebar,
			},
		}
	});
}

const { name, description, headings, sidebar } = Astro.props;
---

<StarlightPage 
	frontmatter={{ 
		title: name,
		description: description,
	}} 
	headings={headings}
	sidebar={sidebar}
>
	<Command name={name} />
</StarlightPage>

